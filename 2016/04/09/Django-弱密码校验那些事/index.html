<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="zheduanyin's life / mind / tech blog"><meta name="google-site-verification" content="8SYOuO4rdMGx-YyY_c0pnFhtcLEPMeajMW8ZSbLQ6F4"><title>Django å¼±å¯†ç æ ¡éªŒé‚£äº›äº‹ - zheduanyin's life / mind / tech blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><link rel="shortcut icon" type="image/x-icon"><link rel="apple-touch-icon"><link rel="apple-touch-icon-precomposed" href="NaN"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div id="header"><div class="site-name"><h1 class="hidden">Django å¼±å¯†ç æ ¡éªŒé‚£äº›äº‹</h1><a id="logo" href="/.">Loved One</a><p class="subtitle">å£æŒ‚ç›¸ç‰‡æ­£åœ¨è¤ªè‰²ï¼Œæ¡Œè…¿ç»™é˜³å…‰çƒ˜å¾—æš–æ´‹æ´‹çš„ï¼Œåœ°æ¿å’Œå¢™å£éƒ½æ˜¯ç”¨åŸæœ¨ç å‡ºæ¥çš„ï¼Œæ²¡æœ‰åšå¤ªå¤šå¤„ç†ï¼Œç”šè‡³å¯ä»¥é€è¿‡åœ°é¢çš„å°æ ‘æ´çœ‹åˆ°æ ‘ä¸‹åç€å¼¹ Ukulele çš„å°ç”·å­©å„¿</p></div><div id="nav-menu"><a href="/."> é¦–é¡µ</a><a href="/archives/"> å½’æ¡£</a><a href="/about/"> å…³äº</a><a href="/atom.xml"> è®¢é˜…</a></div></div><div id="content"><div class="post container"><h1 class="post-title"><a href="/2016/04/09/Django-å¼±å¯†ç æ ¡éªŒé‚£äº›äº‹/">Django å¼±å¯†ç æ ¡éªŒé‚£äº›äº‹</a></h1><div class="post-meta">Apr 9, 2016<span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2016/04/09/Django-å¼±å¯†ç æ ¡éªŒé‚£äº›äº‹/" href="/2016/04/09/Django-å¼±å¯†ç æ ¡éªŒé‚£äº›äº‹/#comments" class="ds-thread-count"></a><div class="post-content"><p>å¼±å¯†ç æ ¡éªŒæ˜¯ Django 1.9 æ–°åŠŸèƒ½ä¹‹ä¸€ï¼Œå¯ä»¥é€šè¿‡ settings ä¸­çš„ <code>AUTH_PASSWORD_VALIDATORS</code> æ¥å¼€å¯ã€‚ä»¥ä¸‹æ˜¯å››ä¸ªè‡ªå¸¦çš„æ ¡éªŒå™¨ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±å†™æ ¡éªŒå™¨ï¼Œåªéœ€è¦æŒ‰ç…§ä¸‹è¿°æ ¼å¼æ·»åŠ è¿›å»å°±å¯ä»¥åšç»Ÿä¸€æ ¡éªŒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line">AUTH_PASSWORD_VALIDATORS = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"># ç”¨æˆ·å±æ€§ç›¸ä¼¼éªŒè¯ï¼Œæ£€æŸ¥å¯†ç å’Œä¸€ç»„ç”¨æˆ·çš„å±æ€§çš„ç›¸ä¼¼æ€§</span></span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.UserAttributeSimilarityValidator'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"># æœ€å°é•¿åº¦éªŒè¯ï¼Œæœ€å°æ¥å—é•¿åº¦ä¸º 9</span></span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.MinimumLengthValidator'</span>,</span><br><span class="line">        <span class="string">'OPTIONS'</span>: &#123;</span><br><span class="line">            <span class="string">'min_length'</span>: <span class="number">9</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"># å¸¸è§å¯†ç éªŒè¯ï¼Œè¿™ä¸ªæ£€æŸ¥å™¨ä¼šå¯¹æ¯”å¸¸ç”¨çš„å¼±å¯†ç ï¼Œè¿™äº›å¸¸ç”¨å¯†ç è¢« gzip æ‰“åŒ…å‚¨å­˜åœ¨ `django/contrib/auth/common-passwords.txt.gz` ä¸­</span></span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.CommonPasswordValidator'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"># çº¯æ•°å­—å¯†ç éªŒè¯</span></span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.NumericPasswordValidator'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>å¹¶ä¸æ˜¯ç›´æ¥ set_password å°±ä¼šæ ¡éªŒï¼Œè€Œæ˜¯éœ€è¦åœ¨ set_password å‰æ‰‹åŠ¨è°ƒç”¨ï¼Œç”¨æ³•å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.password_validation <span class="keyword">import</span> validate_password</span><br><span class="line"></span><br><span class="line">validate_password(password, user=<span class="keyword">None</span>, password_validators=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­</p><ul><li>password æ˜¯ raw string çš„ password å­—ç¬¦ä¸²</li><li>user æ˜¯æ£€æŸ¥çš„ç”¨æˆ·å®ä¾‹ï¼Œéå¿…é¡»ã€‚å¦‚æœ validator éœ€è¦æ ¹æ® user å®ä¾‹åšåˆ¤æ–­ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¼ </li><li>password_validators æ˜¯ listï¼ŒåŒ…å«æ‰€æœ‰éœ€è¦æ ¡éªŒçš„ validatorï¼Œä¸æŒ‡å®šçš„è¯é»˜è®¤æ ¡éªŒæ‰€æœ‰ settings.py ä¸­æŒ‡å®šçš„ validator</li></ul><p>å¦‚æœæ‰€æœ‰ validator éƒ½é€šè¿‡ï¼Œè¿”å› Noneï¼›å¦åˆ™ raise åŒ…å«æ‰€æœ‰é”™è¯¯æ¶ˆæ¯çš„ ValidationErrorã€‚</p><p>å®æˆ˜ï¼šåœ¨ form ä¸­æ ¡éªŒç”¨æˆ·çš„ä¸¤æ¬¡å¯†ç è¾“å…¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PasswordInitForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line">    <span class="comment"># RepeatCharField æ˜¯è‡ªå®šä¹‰çš„ä¸€ä¸ª MultiValueField</span></span><br><span class="line">    <span class="comment"># å®ƒæ¥å—ä¸¤ä¸ª CharField è¾“å…¥ï¼Œå¹¶æ£€æŸ¥å…¶æ˜¯å¦ä¸€è‡´</span></span><br><span class="line">    <span class="comment"># å¦‚æœä¸ä¸€è‡´ï¼Œraise ValidationErrorï¼›å¦åˆ™è¿”å›ç›¸åŒçš„ CharField å€¼</span></span><br><span class="line">    password = RepeatCharField()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_password</span><span class="params">(self)</span>:</span></span><br><span class="line">        validate_password(self.cleaned_data[<span class="string">'password'</span>])</span><br><span class="line">        <span class="keyword">return</span> self.cleaned_data[<span class="string">'password'</span>]</span><br></pre></td></tr></table></figure><p>æˆ‘çš„ view æ˜¯è¿™æ ·çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PasswordInitView</span><span class="params">(LoginRequiredMixin, TemplateView)</span>:</span></span><br><span class="line">    template_name = <span class="string">'user/password_init.html'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @json_resp()</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        form = PasswordInitForm(request.POST)</span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            request.user.set_password(form.cleaned_data[<span class="string">'password'</span>])</span><br><span class="line">            request.user.need_reset_password = <span class="keyword">False</span></span><br><span class="line">            request.user.save()</span><br><span class="line">            result[<span class="string">'next'</span>] = get_redirect_url(request, <span class="string">'POST'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result = Error(form.errors)</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure><p>é™„ä¸Š RepeatCharField çš„ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RepeatCharWidget</span><span class="params">(MultiWidget)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        widgets = (</span><br><span class="line">            TextInput(),</span><br><span class="line">            TextInput(),</span><br><span class="line">        )</span><br><span class="line">        super(RepeatCharWidget, self).__init__(widgets)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RepeatCharField</span><span class="params">(MultiValueField)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        fields = (</span><br><span class="line">            CharField(),</span><br><span class="line">            CharField(),</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'error_messages'</span> <span class="keyword">not</span> <span class="keyword">in</span> kwargs <span class="keyword">or</span> <span class="string">'invalid'</span> <span class="keyword">not</span> <span class="keyword">in</span> kwargs.get(<span class="string">'error_messages'</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'error_messages'</span> <span class="keyword">not</span> <span class="keyword">in</span> kwargs:</span><br><span class="line">                kwargs[<span class="string">'error_messages'</span>] = &#123;&#125;</span><br><span class="line">            kwargs[<span class="string">'error_messages'</span>].update(&#123;<span class="string">'invalid'</span>: ugettext_lazy(<span class="string">'Invalid repeat input'</span>)&#125;)</span><br><span class="line"></span><br><span class="line">        kwargs[<span class="string">'widget'</span>] = kwargs.pop(<span class="string">'widget'</span>, RepeatCharWidget())</span><br><span class="line">        super(RepeatCharField, self).__init__(fields, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compress</span><span class="params">(self, data_list)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> data_list[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> value[<span class="number">0</span>] != value[<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(getattr(self, <span class="string">'error_messages'</span>, &#123;&#125;).get(<span class="string">'invalid'</span>, ugettext_lazy(<span class="string">'Repeat input should be the same'</span>)))</span><br><span class="line">        <span class="keyword">return</span> super(RepeatCharField, self).clean(value)</span><br></pre></td></tr></table></figure></div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://blog.iloved.one/2016/04/09/Django-å¼±å¯†ç æ ¡éªŒé‚£äº›äº‹/" data-id="ciok47pbj0005ab8nv6rgzf4z" class="article-share-link">åˆ†äº«åˆ°</a><div class="tags"><a href="/tags/Django/">Django</a><a href="/tags/Tech/">Tech</a></div><div class="post-nav"><a href="/2016/04/21/Ukulele-é˜¶æ®µä¸€/" class="pre">Ukulele é˜¶æ®µä¸€</a><a href="/2016/04/07/Django-ä¸­-ModelForm-çš„ä½¿ç”¨/" class="next">Django ä¸­ ModelForm çš„ä½¿ç”¨</a></div><div data-thread-key="2016/04/09/Django-å¼±å¯†ç æ ¡éªŒé‚£äº›äº‹/" data-title="Django å¼±å¯†ç æ ¡éªŒé‚£äº›äº‹" data-url="http://blog.iloved.one/2016/04/09/Django-å¼±å¯†ç æ ¡éªŒé‚£äº›äº‹/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">åˆ†äº«åˆ°ï¼š</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">å¾®åš</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQç©ºé—´</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">è…¾è®¯å¾®åš</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">å¾®ä¿¡</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/04/09/Django-å¼±å¯†ç æ ¡éªŒé‚£äº›äº‹/" data-title="Django å¼±å¯†ç æ ¡éªŒé‚£äº›äº‹" data-url="http://blog.iloved.one/2016/04/09/Django-å¼±å¯†ç æ ¡éªŒé‚£äº›äº‹/" data-author-key="1" class="ds-thread"></div></div></div><div id="footer"><div id="footer">Â© <a href="/." rel="nofollow">Loved One</a><span id="busuanzi_container_site_uv"> ğŸ¼  è®¿å®¢æ•° </span><span id="busuanzi_value_site_uv"></span><span> ğŸµ </span><br><spen>åœ¨è¿™ä¸ªå¥‡è‘©çš„æ—¶ä»£ï¼Œåªæ„¿åšä¸€ä¸ªä¸å¥‡è‘©çš„ç”·äºº</spen></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'ilovedone'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-75688320-1','auto');ga('send','pageview');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?a3ac28266bf59d2c9c476373df7553f8";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script type="text/javascript" src="/js/toc.js?v=0.0.0" async></script><script type="text/javascript" src="/js/scroll_to_animation.js?v=0.0.0" async></script></body></html>