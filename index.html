<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="zheduanyin's life / mind / tech blog"><meta name="google-site-verification" content="8SYOuO4rdMGx-YyY_c0pnFhtcLEPMeajMW8ZSbLQ6F4"><title>Home - zheduanyin's life / mind / tech blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><link rel="shortcut icon" type="image/x-icon"><link rel="apple-touch-icon"><link rel="apple-touch-icon-precomposed" href="NaN"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div id="header"><div class="site-name"><h1 class="hidden">Loved One</h1><a id="logo" href="/.">Loved One</a><p class="subtitle">壁挂相片正在褪色，桌腿给阳光烘得暖洋洋的，地板和墙壁都是用原木码出来的，没有做太多处理，甚至可以透过地面的小树洞看到树下坐着弹 Ukulele 的小男孩儿</p></div><div id="nav-menu"><a href="/." class="current"> 首页</a><a href="/archives/"> 归档</a><a href="/about/"> 关于</a><a href="/atom.xml"> 订阅</a></div></div><div id="content"><div id="index" class="container post"><div class="post"><h2 class="post-title"><a href="/2016/07/18/和寂寞相处/">和寂寞相处</a></h2><div class="post-meta">2016-07-18</div><a data-thread-key="2016/07/18/和寂寞相处/" href="/2016/07/18/和寂寞相处/#comments" class="ds-thread-count"></a><div class="post-content"><h2 id="猝不及防的第一次"><a href="#猝不及防的第一次" class="headerlink" title="猝不及防的第一次"></a>猝不及防的第一次</h2><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="http://music.163.com/outchain/player?type=2&id=18015961&auto=1&height=66"></iframe><p>从和上司提出离职到上周五，差不多满一个月。</p><p>情绪有点低落，好像有7点了吧，外面暗暗的，我还没进食，很突然地抬头看自己的屋子，过去一个礼拜穿过的衣服乱糟糟地堆在凳子上，空调打的很冷，朝北的玻璃并没有给我留下什么阳光，只有电脑屏幕背光还在亮着，天色不太好，像暴雨前夕。</p><p>又仔细读了一遍刚写完的道别邮件，点了右上角的发送，跟着心里空落落的，像是被大城市遗弃了，这里没有家人，这里没有朋友，哪怕同事也没有，像一个沙漠里孤独的身影，疲惫不堪，好玩的是，那人拿他无神的眼圈扫了一眼来时的路，竟然连脚印都没有留下。有时候会胡乱地想，我在这里干嘛呢，傻傻的，瞧瞧朋友圈里各式各样的景观，多潇洒，我何苦跟自己过不去，但这又是我真实的感受，想讲给你们听。</p><p>我这个人喜欢跟别人聊自己的感受，也同样想听别人讲自己的历程，不喜欢寒暄，有时候和别人长时间在一起，脸上肌肉不够用，明显地感觉到脸笑僵了，恢复不了，也换不了别的表情，一抽一抽地吊在那里，像是在笑，仔细看却又不是，真是好笑。</p><p>最近弹尤克里里有点电吉他的味道，用尽力气冲四根弦发火，停息，再轻软地拨弄一阵，内心也能被自己的温柔安抚，是温柔没错，我喜欢这个词，特别喜欢，就让我再温柔一次。</p><p>和自己相处不容易，时刻盯牢自己，又不时提醒自己，懒懒地躺着躲着是最舒服的，可这个姿势并不解决任何问题，只有想，想，想，一出出内心戏完毕了，睁开眼发现我还在这里，还是这个姿势，只有时间陪我玩，这个爱开玩笑的家伙。睡梦中醒来经常在一个很奇特的点，爬起来溜一圈洗个澡继续睡，跟梦里一样一样的。仍旧没有焦虑，只是寂寞，我想是的。</p><p>很多的第一次出现了，自己不知道是好是坏，总用警惕的心情去迎接，但对于谷底的我来讲还有更糟的事吗？这样想的话大多还的确是好事。遇见同路的人可以搭伴前行，事儿来了也不要怕事儿，说的也是有道理的，这些事儿回头想的时候，还觉得有些惊喜。</p><p>新公司很赞，有新的 MBP 也有健身器材，装修风格逼格饱满，leader 也很靠谱，唯独为什么是 Python 2.7 ??????</p></div><div class="readmore"><a href="/2016/07/18/和寂寞相处/">阅读更多</a></div></div><div class="post"><h2 class="post-title"><a href="/2016/05/31/快餐时代少去的想象力/">快餐时代少去的想象力</a></h2><div class="post-meta">2016-05-31</div><a data-thread-key="2016/05/31/快餐时代少去的想象力/" href="/2016/05/31/快餐时代少去的想象力/#comments" class="ds-thread-count"></a><div class="post-content"><p>我是个喜欢玩的人，除了桌游，电子游戏，乐器，当然更少不了故事接龙这种超激发想象力的玩法。</p><p>今天当真要玩的时候，发现和想象中差了蛮多的。没有兴趣加入的人会图省力给一些已知的，快结果的剧情，不愿花费心思去创造一段故事，即使只需要他讲两三句。</p><p>这种已知的剧情很类似工作中的安全域，正如近几十年来社会越来越精细的分工一样，一个职业往往只需要懂得一些很专领域的知识就可以，而不被鼓励去探索更多。然而最近的一些跨领域合作的成功案例，却又开始颠覆这种已有的分工，给<code>创新是第一生产力</code>这种说法予以强力背书。其实反观历史，起源于原始社会的体力分工，到工业社会的职能分工，再到电子时代的全球化分工，在降低生产成本的同时，缩小了作为一个个体可以接触到的面，时代的底层职能是标签化的，支离破碎的，在上层又被某种统筹逻辑给合多为一，作为最终的成品来销售。在被分化的职位上工作久了，容易形成小格局思维，这也意味着在职业道路上失去创新力，只能越做越低。然而推动科技进步的推手，往往是广度和深度兼具的人，他们是很好的大格局统筹者，这类人关注新技术，同时做很多可能性上的挖掘和实践。</p><p>作为一个个体而言，我更倾向于对自己职业发展方向不作限制地去规划，尽可能多地做纵向和横向的共同发展，多接触一些新鲜血液，看看他们在做什么，为什么要这样做，是怎么做的，思考这些问题可以带来很大的潜在收益，给自己一个开始思索的由头。</p><p>参考 Cool Shell 的这篇<a href="http://coolshell.cn/articles/17295.html" target="_blank" rel="external">让我们来谈谈分工</a>。</p></div><div class="readmore"><a href="/2016/05/31/快餐时代少去的想象力/">阅读更多</a></div></div><div class="post"><h2 class="post-title"><a href="/2016/05/23/用笔/">用笔</a></h2><div class="post-meta">2016-05-23</div><a data-thread-key="2016/05/23/用笔/" href="/2016/05/23/用笔/#comments" class="ds-thread-count"></a><div class="post-content"><p>很久没有跟纸笔打交道，写写画画，很舒服，电脑给不了，长时间接触电子使皮肤出油加重，一如回到了那时的网吧。</p><p>看奇葩说，好喜欢听蔡康永说话，分享人生体验的心态、谦逊的方式，穿透力很强。</p><p>朋友那里听说在玛雅历中，我的图腾是<code>蓝色太阳的鹰</code>，主创造力、洞见，以及视野，我很喜欢这几个词汇。</p><p>花时间和世界沟通，我觉得是再重要不过的事了，在这个过程中，观察自己和他人沟通时的样子，体察自己一路上的变化，空下来的时候回想一下曾经的场景，能不能做到 better man, better life。</p><p>同事要离职了，和他的交流好像大多在顺路地铁上，会讲一些自己的生活，有过的想法，状态，生活中也是为数不多的走心交谈了。</p><p>平时技术部都寡言少语的，不像其他部门，除了需求也没什么话讲，大多在琐碎的技术上，上次和头儿沟通了一下，打心底觉得从他身上可以学到很多东西，不只是技术上，管理啊，为人啊，一些发展的思路啊都很清晰，还能跟没什么交集的人交流地很顺畅，这点很厉害，能从别人的讲述中挖出自己擅长的点，从对方的需求中理顺它。</p><p>昨天去岳父家吃了传说中恶评如潮的<code>很高兴遇见你</code>，没有想象中的难吃，地方很宽敞，光线也很主题化，大多在自己桌上，别人桌上的东西都融进了背景。</p></div><div class="readmore"><a href="/2016/05/23/用笔/">阅读更多</a></div></div><div class="post"><h2 class="post-title"><a href="/2016/05/15/别人的劣质烟未必比你的更差/">别人的劣质烟未必比你的更差</a></h2><div class="post-meta">2016-05-15</div><a data-thread-key="2016/05/15/别人的劣质烟未必比你的更差/" href="/2016/05/15/别人的劣质烟未必比你的更差/#comments" class="ds-thread-count"></a><div class="post-content"><p>一大波加班节奏正在袭来，忙里偷闲观察了一下办公室和自己的一些症状</p><p>有一天门外的烟味特别重，进进出出的人中很少看到把门关死的（可能在想我就出去一会会，关掉的话回来的时候还要按指纹，就索性开一会吧），劣质香烟的味道就肆无忌惮地朝办公室里灌，像扫黄队抓到嫖娼的人一样 aggresive，闻上两秒就能头晕。而大家都注意到如此浓烈味道的前提下，抱怨<code>外面烟味这么重，为什么不关门！</code>最大声的那个人，TA 自己走出去的时候同样没有把门带上。</p><p>人们边抱怨着别人怎样怎样，一边又做着同样事，自己丝毫不知。</p><p>周六加班，周日去做四维彩超，有点迫不及待的兴奋，和小家伙的第一次见面，小嘴嘟哝着砸吧砸吧，小手缩在脑袋下面，老可爱了。</p><p>在办公室里一个空旷的地方，坐着转椅一直转，一直转，有点惬意地晕乎乎，眼睛盯着 60° 天花板，停下来后天花板仍然在转，和想象中的嗑药一样，这个状态能持续半分钟，舒服。</p></div><div class="readmore"><a href="/2016/05/15/别人的劣质烟未必比你的更差/">阅读更多</a></div></div><div class="post"><h2 class="post-title"><a href="/2016/05/12/SOA-前后端分离的-Web-架构/">SOA 前后端分离的 Web 架构</a></h2><div class="post-meta">2016-05-12</div><a data-thread-key="2016/05/12/SOA-前后端分离的-Web-架构/" href="/2016/05/12/SOA-前后端分离的-Web-架构/#comments" class="ds-thread-count"></a><div class="post-content"><p>新项目用了 Web + BFF + Service 这种前后端分的比较开的架构，用起来蛮舒服，其中 Web 层负责提供 HTML / JS；BFF 层则是做权限校验、缓存、逻辑整合、内容聚合拆分、向 Service 层请求数据；最底层的 Service 层提供数据库的数据操作，过滤等 API，这层位于内网，只有 BFF 层可以访问。三层都通过 HTTP 协议来提供服务。</p><p>这个架构的好处很明显</p><ul><li>前后端分离，修改十分方便</li><li>系统拓展性强，可以通过修改 BFF 的方式来控制暴露出去的 API</li><li>每个 Service 都只负责自己功能下的小型数据库，可以灵活使用不同数据库种类来使系统发挥更好的性能</li><li>系统权责明确，每个部件只需要维护自己的逻辑</li></ul><p>可提高的地方在</p><ul><li>底层难以对应到上层业务，Debug 复杂</li><li>HTTP 请求数量显著增多，使得系统性能降低</li><li>开发、测试难度提高，LOG 增多</li></ul><p>这种前后端分离的实现方法，在业界也叫做 SOA，即面向服务架构，和面向方法，面向对象，和面向切面相比，它的关注点在更为宏观的层面；对于传统的软件架构来讲，它更符合 KISSY 的理念，更易于拓展，同时也更为开放。</p><p>wiki 看了一下编程范式，里面很多词汇都是经常读到却不知道它的具体意思，这几天读一下，读完来会来这里介绍一下这些范式。</p></div><div class="readmore"><a href="/2016/05/12/SOA-前后端分离的-Web-架构/">阅读更多</a></div></div><div class="post"><h2 class="post-title"><a href="/2016/04/22/给自己画圈/">给自己画圈</a></h2><div class="post-meta">2016-04-22</div><a data-thread-key="2016/04/22/给自己画圈/" href="/2016/04/22/给自己画圈/#comments" class="ds-thread-count"></a><div class="post-content"><h2 id="给自己画圈，并不为牢"><a href="#给自己画圈，并不为牢" class="headerlink" title="给自己画圈，并不为牢"></a>给自己画圈，并不为牢</h2><p>奇葩说里的一个论题很有意思，说<a href="http://www.iqiyi.com/v_19rroew0y8.html" target="_blank" rel="external">婚后遇到自己的今生挚爱，你会怎么办？</a></p><p>我会放弃，这段感情是我为自己画的圈，会这样做的有几种人，一种人是尚处懵懂，觉得好，那便是好，放手去做；一种人阅遍世间风尘，最后降落到属于自己的栖息地；还有一种，牵起你的手时，就已选择了放弃余生所有挚爱。</p><p>我便是最后那种。</p><p>09 说的一生是抗争的一生，每个人都是，我不愿成为令我厌恶的一份子，我不愿成为孩子眼中那样的父亲，一个令人失望的家庭。</p><p>其实我儿时的记忆，在感情方面并没有留下什么美好印记，像水一样习惯了所有人这副样子，鄙视这个世界，不说话，沉溺在游戏里，远离人群观察世界，要么爱搭不理，要么出口伤人。可以说遇到你之前，我的世界充斥着愚蒙未化的灰色调。当你身上的彩色不经意蹭到我的时候，我看到了一些我不曾经历的东西，我发现自己喜欢那样，那种无论世界变怎样，你知道我在这，我也知道你就在那的感觉。我要你，我要守着你，哪怕眼睛不再睁开，哪怕双腿不能行走，我愿意舍弃这个世界来守候你。</p><p>能不把这种令人厌恶的基因带到未来的话，心里深不见底的失望可能还有救。</p></div><div class="readmore"><a href="/2016/04/22/给自己画圈/">阅读更多</a></div></div><div class="post"><h2 class="post-title"><a href="/2016/04/21/Ukulele-阶段一/">Ukulele 阶段一</a></h2><div class="post-meta">2016-04-21</div><a data-thread-key="2016/04/21/Ukulele-阶段一/" href="/2016/04/21/Ukulele-阶段一/#comments" class="ds-thread-count"></a><div class="post-content"><p>总结了一些小发现</p><h2 id="左手"><a href="#左手" class="headerlink" title="左手"></a>左手</h2><ul><li>按弦不要太用力</li><li>位置尽量靠近品码，但不要碰到</li><li>手指尽量站立</li></ul><h2 id="古典指法"><a href="#古典指法" class="headerlink" title="古典指法"></a>古典指法</h2><ul><li>古典指法比流行指法指位更好按，但很累大拇指，因为要时刻保持按压力，可以在移动手指的时候琴头不下落</li></ul><h2 id="流行指法"><a href="#流行指法" class="headerlink" title="流行指法"></a>流行指法</h2><ul><li>大幅移动手指时，滑动虎口</li></ul><h2 id="扫弦"><a href="#扫弦" class="headerlink" title="扫弦"></a>扫弦</h2><ul><li>手指内扣，侧面接触面越大声音越柔和</li><li>直接用垂直的手指甲尖扫声音更尖锐</li></ul><h2 id="音"><a href="#音" class="headerlink" title="音"></a>音</h2><ul><li>要让发声干净的话需要消除左手离弦发出的音，可以通过左手/右手制音（弦轻轻按住，让其不出声）</li></ul><h2 id="脚"><a href="#脚" class="headerlink" title="脚"></a>脚</h2><ul><li>用脚踩节奏，要稳</li></ul></div><div class="readmore"><a href="/2016/04/21/Ukulele-阶段一/">阅读更多</a></div></div><div class="post"><h2 class="post-title"><a href="/2016/04/09/Django-弱密码校验那些事/">Django 弱密码校验那些事</a></h2><div class="post-meta">2016-04-09</div><a data-thread-key="2016/04/09/Django-弱密码校验那些事/" href="/2016/04/09/Django-弱密码校验那些事/#comments" class="ds-thread-count"></a><div class="post-content"><p>弱密码校验是 Django 1.9 新功能之一，可以通过 settings 中的 <code>AUTH_PASSWORD_VALIDATORS</code> 来开启。以下是四个自带的校验器，当然也可以自己写校验器，只需要按照下述格式添加进去就可以做统一校验。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line">AUTH_PASSWORD_VALIDATORS = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"># 用户属性相似验证，检查密码和一组用户的属性的相似性</span></span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.UserAttributeSimilarityValidator'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"># 最小长度验证，最小接受长度为 9</span></span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.MinimumLengthValidator'</span>,</span><br><span class="line">        <span class="string">'OPTIONS'</span>: &#123;</span><br><span class="line">            <span class="string">'min_length'</span>: <span class="number">9</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"># 常见密码验证，这个检查器会对比常用的弱密码，这些常用密码被 gzip 打包储存在 `django/contrib/auth/common-passwords.txt.gz` 中</span></span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.CommonPasswordValidator'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"># 纯数字密码验证</span></span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.NumericPasswordValidator'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>并不是直接 set_password 就会校验，而是需要在 set_password 前手动调用，用法如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.password_validation <span class="keyword">import</span> validate_password</span><br><span class="line"></span><br><span class="line">validate_password(password, user=<span class="keyword">None</span>, password_validators=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure><p>其中</p><ul><li>password 是 raw string 的 password 字符串</li><li>user 是检查的用户实例，非必须。如果 validator 需要根据 user 实例做判断，那么就需要传</li><li>password_validators 是 list，包含所有需要校验的 validator，不指定的话默认校验所有 settings.py 中指定的 validator</li></ul><p>如果所有 validator 都通过，返回 None；否则 raise 包含所有错误消息的 ValidationError。</p><p>实战：在 form 中校验用户的两次密码输入</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PasswordInitForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line">    <span class="comment"># RepeatCharField 是自定义的一个 MultiValueField</span></span><br><span class="line">    <span class="comment"># 它接受两个 CharField 输入，并检查其是否一致</span></span><br><span class="line">    <span class="comment"># 如果不一致，raise ValidationError；否则返回相同的 CharField 值</span></span><br><span class="line">    password = RepeatCharField()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_password</span><span class="params">(self)</span>:</span></span><br><span class="line">        validate_password(self.cleaned_data[<span class="string">'password'</span>])</span><br><span class="line">        <span class="keyword">return</span> self.cleaned_data[<span class="string">'password'</span>]</span><br></pre></td></tr></table></figure><p>我的 view 是这样的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PasswordInitView</span><span class="params">(LoginRequiredMixin, TemplateView)</span>:</span></span><br><span class="line">    template_name = <span class="string">'user/password_init.html'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @json_resp()</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        form = PasswordInitForm(request.POST)</span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            request.user.set_password(form.cleaned_data[<span class="string">'password'</span>])</span><br><span class="line">            request.user.need_reset_password = <span class="keyword">False</span></span><br><span class="line">            request.user.save()</span><br><span class="line">            result[<span class="string">'next'</span>] = get_redirect_url(request, <span class="string">'POST'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result = Error(form.errors)</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure><p>附上 RepeatCharField 的代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RepeatCharWidget</span><span class="params">(MultiWidget)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        widgets = (</span><br><span class="line">            TextInput(),</span><br><span class="line">            TextInput(),</span><br><span class="line">        )</span><br><span class="line">        super(RepeatCharWidget, self).__init__(widgets)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RepeatCharField</span><span class="params">(MultiValueField)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        fields = (</span><br><span class="line">            CharField(),</span><br><span class="line">            CharField(),</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'error_messages'</span> <span class="keyword">not</span> <span class="keyword">in</span> kwargs <span class="keyword">or</span> <span class="string">'invalid'</span> <span class="keyword">not</span> <span class="keyword">in</span> kwargs.get(<span class="string">'error_messages'</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'error_messages'</span> <span class="keyword">not</span> <span class="keyword">in</span> kwargs:</span><br><span class="line">                kwargs[<span class="string">'error_messages'</span>] = &#123;&#125;</span><br><span class="line">            kwargs[<span class="string">'error_messages'</span>].update(&#123;<span class="string">'invalid'</span>: ugettext_lazy(<span class="string">'Invalid repeat input'</span>)&#125;)</span><br><span class="line"></span><br><span class="line">        kwargs[<span class="string">'widget'</span>] = kwargs.pop(<span class="string">'widget'</span>, RepeatCharWidget())</span><br><span class="line">        super(RepeatCharField, self).__init__(fields, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compress</span><span class="params">(self, data_list)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> data_list[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> value[<span class="number">0</span>] != value[<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(getattr(self, <span class="string">'error_messages'</span>, &#123;&#125;).get(<span class="string">'invalid'</span>, ugettext_lazy(<span class="string">'Repeat input should be the same'</span>)))</span><br><span class="line">        <span class="keyword">return</span> super(RepeatCharField, self).clean(value)</span><br></pre></td></tr></table></figure></div><div class="readmore"><a href="/2016/04/09/Django-弱密码校验那些事/">阅读更多</a></div></div><div class="post"><h2 class="post-title"><a href="/2016/04/07/Django-中-ModelForm-的使用/">Django 中 ModelForm 的使用</a></h2><div class="post-meta">2016-04-07</div><a data-thread-key="2016/04/07/Django-中-ModelForm-的使用/" href="/2016/04/07/Django-中-ModelForm-的使用/#comments" class="ds-thread-count"></a><div class="post-content"><h2 id="什么是-ModelForm"><a href="#什么是-ModelForm" class="headerlink" title="什么是 ModelForm"></a>什么是 ModelForm</h2><p>ModelForm 是 Django 中编写基于 Model 定制表单的方法，可以提高 Model 复用性。</p><p>使用时 Django 会根据 <code>django.db.models.Field</code> (用于数据库衔接) 自动转化为 <code>django.forms.Field</code> (用于表单前端展示、后端验证)。</p><h2 id="定义-ModelForm-表单"><a href="#定义-ModelForm-表单" class="headerlink" title="定义 ModelForm 表单"></a>定义 ModelForm 表单</h2><p>举一个书籍管理例子，这个例子中定义了</p><ul><li>title 字段，存 char，用于储存书籍的标题<ul><li>最大允许长度 20</li><li>数据库唯一值，这意味着数据库不能储存两个相同标题的书</li></ul></li><li>author 字段，存 Author 的外键，指向储存书籍的作者</li></ul><p>Model<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">20</span>, unique=<span class="keyword">True</span>)</span><br><span class="line">    author = models.ForeignKey(<span class="string">'Author'</span>)</span><br></pre></td></tr></table></figure></p><p>ModelForm<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticleForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Article</span><br></pre></td></tr></table></figure></p><p>用 Form 来构造的话这个 ModelForm 类似这样<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticleForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line">    title = forms.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    author = forms.ModelChoiceField(queryset=Author.objects.all())</span><br></pre></td></tr></table></figure></p><h3 id="定制-ModelForm-表单"><a href="#定制-ModelForm-表单" class="headerlink" title="定制 ModelForm 表单"></a>定制 ModelForm 表单</h3><p>ModelForm 提供了自定义 Field、错误信息、渲染方法、正反选择模型的字段等。</p><p>如何定制 ModelForm 呢？有两种方式：Meta (ModelForm 独有) 和自定义字段 (普通 Form 中也可使用)。</p><h4 id="Meta"><a href="#Meta" class="headerlink" title="Meta"></a>Meta</h4><p>ModelForm 通过 Meta 把 db.Field 自动转化为 forms.Field，其中涉及到几步转化</p><ul><li>validators 不变</li><li>添加 widget 属性，即前端的渲染方式</li><li>修改 Model 包含的字段，通过 fields 来拿指定字段或者通过 exclude 来排除指定字段</li><li>修改错误信息</li></ul><p>我们可以通过下面的例子来看一看如何通过 Meta 来自定义 ModelForm 的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticleForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        <span class="comment"># 指定 Model</span></span><br><span class="line">        model = Article</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Form 需要 Model 中的哪几个 Field</span></span><br><span class="line">        fields = [<span class="string">'title'</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Form 排除 Model 中的哪几个 Field</span></span><br><span class="line">        exclude = [<span class="string">'author'</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 自定义 error_message</span></span><br><span class="line">        error_messages = &#123;</span><br><span class="line">            <span class="string">'invalid'</span> = <span class="string">'invalid title'</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 自定义 widget，这里使用了长 80 列，宽 20 行的 textarea</span></span><br><span class="line">        widgets = &#123;</span><br><span class="line">            <span class="string">'name'</span>: Textarea(attrs=&#123;<span class="string">'cols'</span>: <span class="number">80</span>, <span class="string">'rows'</span>: <span class="number">20</span>&#125;),</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><blockquote><p>Meta 的缺点是不能修改字段的 validators，如果需要修改 validators，需要在 Meta 外部重新定义一个同名 Field 来覆盖之</p></blockquote><h4 id="在-Form-中另外定义-Field"><a href="#在-Form-中另外定义-Field" class="headerlink" title="在 Form 中另外定义 Field"></a>在 Form 中另外定义 Field</h4><p>这是 Form 中通用的定义 Field 的方法，在 ModelForm 中它有两个作用</p><ol><li>补充 Model 没有的 Field 到表单</li><li>覆盖 Model 中的 Field 定义</li></ol><p>且看下面的例子，Article 中已经包含了 title 字段，我们在 ModelForm 中重新定义了它，把 CharField 改为了 ChoiceField，并且自定义了 validators。</p><p>注意：覆盖 title 的时候，把 title 从 Meta 中 exclude 掉是可选的，去不去掉的区别在于，你是否需要它为你校验 <code>unique=True</code> 这个数据库级限制。在这里我们需要校验，因为 ModelForm 校验通过后我需要把它存入数据库，如果这里没有校验的话，碰到同标题的书数据库就会在储存时报错，我们希望把这步校验放在 ModelForm 的校验中，而不是在通过校验后再用 <code>try... catch...</code> 来捕获它。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticleForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">    title = forms.ChoiceFied(choices=((<span class="number">1</span>, <span class="string">'罗宾汉'</span>), (<span class="number">2</span>, <span class="string">'田伯光'</span>),), validators=MaxValueValidator(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Article</span><br></pre></td></tr></table></figure><h3 id="值得一提的一些-Field-转化"><a href="#值得一提的一些-Field-转化" class="headerlink" title="值得一提的一些 Field 转化"></a>值得一提的一些 Field 转化</h3><h4 id="AutoField"><a href="#AutoField" class="headerlink" title="AutoField"></a>AutoField</h4><p>该 Field 不会出现在 ModelForm 表单中。</p><blockquote><p>所有 <code>editable=False</code> 的 Field 都不会出现在 ModelForm 中。</p></blockquote><h4 id="BooleanField"><a href="#BooleanField" class="headerlink" title="BooleanField"></a>BooleanField</h4><p>由于表单提交时统一识别为 string，而 <code>BooleanField</code> 是用 python 中的 <code>bool</code> 来判断的，所以只要传了任意非空值，<code>BooleanField</code> 都会当做 True 来处理，而如果传了空值，由于 <code>forms.Field</code> 默认属性是 <code>required=True</code>，会校验失败，所以如果你需要一个可以填 False 的 Field，那么你需要在 Form 中手动设置这个 Field 的 <code>required=False</code>。</p><h4 id="ForeignKey"><a href="#ForeignKey" class="headerlink" title="ForeignKey"></a>ForeignKey</h4><p>ForeignKey 自动转化为 ModelChoiceField，用下拉选项菜单渲染，默认渲染出来的选项显示为对应 Field 的 <code>__str__</code>，提交的值为对应 Field 的 <code>id</code>，这些都可以定制。</p><p>在后端接收提交的时候会自动在对应的 Model 中用 id 去找，如果没找到则抛出 ValidationError。</p><h4 id="ManyToManyField"><a href="#ManyToManyField" class="headerlink" title="ManyToManyField"></a>ManyToManyField</h4><p>ManyToManyField 自动转化为 ModelMultipleChoiceField，用多选框渲染，同样默认渲染出来的选项显示为对应 Field 的 <code>__str__</code>，提交的值为对应 Field 的 <code>id</code> 值。</p><p>比如有个叫 group 的 ManyToManyField，选中了 <code>&#39;finance&#39;</code> <code>&#39;develop&#39;</code> 这两个选项，他们的 id 分别为 1 和 2，那么世界上提交的表单 QueryString 就是 <code>group=1&amp;group=2</code></p><h2 id="初始化-ModelForm-表单"><a href="#初始化-ModelForm-表单" class="headerlink" title="初始化 ModelForm 表单"></a>初始化 ModelForm 表单</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">form = ArticleForm(request.POST)</span><br></pre></td></tr></table></figure><ul><li>校验的时候可以定义 instance 参数来给 ModelForm 初始化实例，即后续的修改都作用在这个实例上</li><li><p>可以定义 initial 参数来给 ModelForm 初始值，同名 Field 会覆盖 instance 的值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">article = Article.objects.get(pk=<span class="number">1</span>)</span><br><span class="line">author = Author.objects.first()</span><br><span class="line"></span><br><span class="line">form = ArticleForm(request.POST, instance=article, initial=&#123;<span class="string">'author'</span>: author&#125;)</span><br><span class="line"><span class="comment"># 到这里的时候 form 已经绑定到 article 对象了，并且 author Field 的初始值为 author 对象。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> form.is_valid():</span><br><span class="line">    form.save()</span><br></pre></td></tr></table></figure><blockquote><p>这里数据加载的先后顺序为 instance &lt; initial &lt; request.POST</p></blockquote></li></ul><h2 id="校验-ModelForm-表单"><a href="#校验-ModelForm-表单" class="headerlink" title="校验 ModelForm 表单"></a>校验 ModelForm 表单</h2><blockquote><p>注意：Form 只会检查内部定义过的 Field，request.POST 中其余 keyword 都会被无视和过滤掉，即不会出现在返回的 cleaned_data 中。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">form = ArticleForm(request.POST)</span><br><span class="line"><span class="comment"># 校验表单</span></span><br><span class="line"><span class="keyword">if</span> form.is_valid():</span><br><span class="line">    <span class="comment"># 保存到数据库</span></span><br><span class="line">    article = form.save()</span><br></pre></td></tr></table></figure><p><code>is_valid()</code> 会调用 <code>full_clean()</code>来对表单进行全面校验，它又分成三步（定义在基类 Form）中</p><ol><li>根据每个 Field 来做单个 Field 的校验 ( 比如 title 字段就会校验是否超出最大允许长度 20 ) 其中在 <code>Field.clean()</code> 执行过后提供了钩子 <code>clean_[field_name]</code></li><li>根据 Form 定义的 Field 之间的依赖关系做整个表单的校验，钩子方法为 <code>clean()</code></li><li>自定义校验通过后的表单处理，钩子叫 <code>_post_clean()</code><ul><li>这一步中，ModelForm 做了一些额外的检验：如果定义在 Meta 中的 Field 有 <code>unique=True</code> 这个限制，那么 ModelForm 则会按照现有数据库中的数据对其校验，看这个 Field 的值是否已存在，如果已存在，则抛出一个 <code>IntegrityError</code>。实际操作中如果强制不校验 unique 的话，可以把该字段从 Meta 中移除，在 ModelForm 中重新定义该字段。</li></ul></li></ol><h2 id="储存-ModelForm-对象"><a href="#储存-ModelForm-对象" class="headerlink" title="储存 ModelForm 对象"></a>储存 ModelForm 对象</h2><p>调用 <code>save()</code> 的时候可以添加 <code>commit=False</code> 来避免立即储存，从而通过后续的修改或补充来得到完整的 Model 实例后再储存到数据库。</p><p>如果初始化的时候传入了 instance，那么调用 <code>save()</code> 的时候会用 ModelForm 中定义过的字段值覆盖传入实例的相应字段，并写入数据库。</p><p><code>save()</code> 同样会帮你储存 ManyToManyField，如果 save 时使用了 <code>commit=False</code>，那么 ManyToManyField 的储存需要等该条目存入数据库之后手动调用 ModelForm 的 <code>save_m2m()</code> 方法。</p><h3 id="使用同一表单来-新建-更新-指定实例"><a href="#使用同一表单来-新建-更新-指定实例" class="headerlink" title="使用同一表单来 新建 | 更新 指定实例"></a>使用同一表单来 新建 | 更新 指定实例</h3><p>通常的步骤分为如下几步</p><ul><li>检测该对象是否已在数据库<ul><li>如果已存在，那么需要手动获取该实例，然后更改相关 field 内容，最后使用 <code>update()</code> 方法保存到数据库</li><li>如果不存在，新建一个 Model 实例并修改至完整的 Model，调用 <code>save()</code> 方法保存到数据库</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">f = AuthorForm(request.POST)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> f.is_valid():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># Save the new instance.</span></span><br><span class="line">        new_author = f.save(commit=<span class="keyword">False</span>)</span><br><span class="line">        new_author.some_field = f.cleaned_data[<span class="string">'some_field'</span>]</span><br><span class="line">        new_author.save()</span><br><span class="line">    <span class="keyword">except</span> IntegrityError:</span><br><span class="line">        <span class="comment"># 已存在</span></span><br><span class="line">        <span class="comment"># 若要这样使用 update 的话需要在 cleaned_data 中加入上述 some_field 的改动</span></span><br><span class="line">        <span class="comment"># 因为 some_field 的改动只在 new_author 中使用，并不能更新到数据库</span></span><br><span class="line">        Author.objects.filter(pk=f.cleaned_data[<span class="string">'pk'</span>]).update(f.cleaned_data)</span><br></pre></td></tr></table></figure><p>太麻烦了！其实 Django 中已经有 <code>update_or_create</code> 方法已经实现了上述所有功能，可以避免这个 <code>try ... except ...</code> 判断实例是否已存在，我们来看这个例子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># forms.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthorAddForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">    <span class="comment"># 确保 pk 不是必须字段</span></span><br><span class="line">    <span class="comment"># 如果不传，自动识别为 None</span></span><br><span class="line">    pk = forms.IntegerField(required=<span class="keyword">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Author</span><br><span class="line">        fields = [<span class="string">'name'</span>, <span class="string">'address'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_post_clean</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(forms.ModelForm, self)._post_clean()</span><br><span class="line">        <span class="comment"># 不传 pk 的话表示需要新建一个条目</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.cleaned_data[<span class="string">'pk'</span>]:</span><br><span class="line">            <span class="comment"># 添加需要的 Field</span></span><br><span class="line">            self.cleaned_data[<span class="string">'Origin'</span>] = City.objects.get(Province=<span class="string">'北京'</span>, City=<span class="string">'北京'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthorsView</span><span class="params">(LoginRequiredMixin, TemplateView)</span>:</span></span><br><span class="line">    template_name = <span class="string">'authors.html'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        form = AuthorAddForm(request.POST)</span><br><span class="line">        result = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> form.is_valid():</span><br><span class="line">            <span class="keyword">return</span> form.errors</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果 pk 不存在，为 None，那么 update_or_create 匹配失败，从而进入 create 流程</span></span><br><span class="line">        <span class="comment"># 否则 pk 存在表单中，那么尝试匹配数据库，如果命中，进行 update 操作，否则进行 create 操作</span></span><br><span class="line">        Author, created = Author.objects.update_or_create(pk=form.cleaned_data[<span class="string">'pk'</span>], defaults=form.cleaned_data)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Author.pk</span><br></pre></td></tr></table></figure><p>其中 <code>update_or_create</code> 通过检测所有非 defaults 的字段，在上述例子中就是 <code>id=form.cleaned_data[&#39;id&#39;]</code> 一项是否已存在于数据库而判断是用 <code>update()</code> 还是 <code>create()</code>，而不论是 <code>update()</code> 还是 <code>create()</code>，都会使用 cleaned_data 作为数据源来写入数据库。</p></div><div class="readmore"><a href="/2016/04/07/Django-中-ModelForm-的使用/">阅读更多</a></div></div><div class="post"><h2 class="post-title"><a href="/2016/03/20/Ukulele-See-You-Again/">See You Again | Ukulele TAB谱</a></h2><div class="post-meta">2016-03-20</div><a data-thread-key="2016/03/20/Ukulele-See-You-Again/" href="/2016/03/20/Ukulele-See-You-Again/#comments" class="ds-thread-count"></a><div class="post-content"><p>最近还在练的一首 See You Again，很短，上手也快，能练习到一些滑音，锤音，很有意思，推荐大家来练习一下。另外，我的 Ukulele 直播暂时关闭一阵，等神功练就再来卖弄。</p><p><img src="http://7xrt3i.com1.z0.glb.clouddn.com/ukulele/see-you-again.jpg" alt="see-you-again"></p><p>直播有三四天了，每次播的时候心里都挺紧张，有点打鼓。是不是有人在看我直播？会不会觉得我玩的太烂就走了？是不是该切出去看看留言？什么？怎么没人留言？！总之分心的点很多，集中精神很难，十分不喜欢这种感觉，所以还是先单机线下练，练的还可以了再上来直播。</p></div><div class="readmore"><a href="/2016/03/20/Ukulele-See-You-Again/">阅读更多</a></div></div><div class="post"><h2 class="post-title"><a href="/2016/03/18/Ukulele-旅行的意义/">旅行的意义 | Ukulele TAB谱</a></h2><div class="post-meta">2016-03-18</div><a data-thread-key="2016/03/18/Ukulele-旅行的意义/" href="/2016/03/18/Ukulele-旅行的意义/#comments" class="ds-thread-count"></a><div class="post-content"><p>最近在练的一首歌，谱子来自<a href="http://www.tanukulele.com/?p=4705">尤克里里小站</a>上<a href="http://www.shushuma.com/">马叔叔</a>的教程，顺手开了个<a href="http://www.douyutv.com/notme">斗鱼直播</a>，没事的话晚上7点-9点会出来露脸，把自己练U的过程分享给大家，跟大家交流交流学习 Ukulele 的经验。</p><p>这个谱子对于我现在的水平还是略难，<ruby>(≧ω≦)/<rp>(</rp><rt>nǔ lì liǎn</rt><rp>)</rp></ruby></p><ul><li>扫弦力度不均匀</li><li>把位切换困难，特别高低把位切换（高把位不熟悉）</li><li>读 TAB 谱不顺溜</li></ul><p>要练的注意</p><ul><li>需要熟练切音</li><li>并非单一节奏型</li><li>高把位 | 低把位 混合</li></ul><p>话不多说，把谱子先上了，图片觉得小的话可以试试浏览器的放大功能，<code>Ctrl</code> <code>+</code></p><p><img src="http://7xrt3i.com1.z0.glb.clouddn.com/ukulele/%E6%97%85%E8%A1%8C%E7%9A%84%E6%84%8F%E4%B9%89.jpg" alt="旅行的意义"></p></div><div class="readmore"><a href="/2016/03/18/Ukulele-旅行的意义/">阅读更多</a></div></div><div class="post"><h2 class="post-title"><a href="/2016/03/14/走出倾斜的世界/">走出倾斜的世界</a></h2><div class="post-meta">2016-03-14</div><a data-thread-key="2016/03/14/走出倾斜的世界/" href="/2016/03/14/走出倾斜的世界/#comments" class="ds-thread-count"></a><div class="post-content"><p>最近疯狂动物城很火，今天读到了篇影评，讲职场女性、独立和偏见，写的很深入，这个话题在生活中很少去提及，读完自己也有点想法。</p><p>它的可怕之处在于让宿主看不清真正的自己，甚至自己都不自知，是一个典型的社会产物。人们从来都拿自己的际遇站队，而其中大多都未曾有机会去到天平另一端，那里的滋味如何更是无从说起。它已经混在社会的自私基因中，没人说起，却又分分钟以刺眼的姿态出现。</p><p>记得<strong>《沉默的代价》</strong>吗？它讲人类群体性的自私，也是一种更广义的偏见。</p><blockquote><p>起初他們抓了所有的共產黨人；<br>我沒有出聲，<br>因為我不是共產黨人。<br>接著他們抓了所有的猶太人；<br>我沒有出聲，<br>因為我不是猶太人。<br>然後他們抓了所有的工會骨幹；<br>我沒有出聲，<br>因為我不是工會骨幹。<br>後來他們抓了所有的天主教徒；<br>我沒有出聲，<br>因為我屬於新教。<br>最後他們來抓我；<br>到那時候，<br>已經沒有剩下能出聲講話的人了。</p></blockquote><p>性别歧视、生理歧视、猎奇心理都属偏见，拿我自己来说，我发现了自己有猎奇心理，来源于好奇。它出现时我自己压根毫无感知，事后想想才觉得自己表现很异常。比如看到一些没怎么接触过的人（和尚、同性恋、外国人、有明显残疾的人），自己的猎奇心理控制不住，会去观察，即使我的内心拒绝对人的过度观察。</p><p>想要走出倾斜的世界，观察可以有，但不应该是猎奇的衍生，如果第一次接触的出发点就定在猎奇上，这次接触在你眼里的走向很有可能是自己下意识的杜撰而非客观事实。拿陈冠希来说，艳照门之前我对他的了解仅限于几部电影中的出色演出，之后被媒体刷为乱交、贵圈真乱、流出、张柏芝 等，这个印象一直持续到一篇来自<a href="http://showstudio.com/">SHOWstudio</a>的<a href="https://mp.weixin.qq.com/s?__biz=MjM5MzA0NDA4MA==&amp;mid=405861323&amp;idx=1&amp;sn=41fae1b0f568cfc100d8a69af594bf82">采访</a>，作为事件起因的陈冠希讲述了事件发生后媒体、朋友、政府、家人都做了些什么，以及自己对事件的看法。看完以后我不免有些路转粉，他对传统文化中保守的理解，对青年文化的理解，对自我的挖掘，都是很有借鉴意义的。特别是一路走来，从短时间内获得了一切的富二代一线明星到艳照门曝光被迫退出演艺圈再到成功转型创作者复出演艺圈，都展示出对自己人生、事业的态度和信心。我想对他的偏见已经消失了，那么这个偏见是哪里来的呢？</p><ol><li>对他不了解，但他属于贵圈</li><li>对贵圈不了解，但贵圈有很多**方面的新闻</li><li>既然他属于贵圈，那么肯定有这方面的大环境属性（偏见）</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Guiquan</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    sexual_life = <span class="string">'chaos'</span></span><br><span class="line">    mind = <span class="string">'selfish'</span></span><br><span class="line">    drug = <span class="keyword">True</span></span><br><span class="line">    interest = [<span class="string">'power'</span>, <span class="string">'money'</span>, <span class="string">'sex'</span>, <span class="string">'drug'</span>, <span class="string">'fame'</span>]</span><br><span class="line"></span><br><span class="line">    appearance = <span class="number">50</span></span><br><span class="line">    talent = <span class="number">50</span></span><br><span class="line">    ambition = <span class="number">50</span></span><br><span class="line">    wealth = <span class="number">50</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, appearance, talent, ambition, wealth)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.appearance = appearance</span><br><span class="line">        self.talent = talent</span><br><span class="line">        self.ambition = ambition</span><br><span class="line">        self.wealth = wealth</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ec = Guiquan(<span class="string">'Edison Chen'</span>, <span class="number">90</span>, <span class="number">90</span>, <span class="number">90</span>, <span class="number">90</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 然而很多人下面就不看了，没兴趣看因为不够爆</span></span><br><span class="line">ec.mind = [<span class="string">'western'</span>, <span class="string">'logical'</span>, <span class="string">'revolution'</span>]</span><br><span class="line">ec.interests = [<span class="string">'sex'</span>, <span class="string">'youth culture'</span>, <span class="string">'design'</span>, <span class="string">'personal_life'</span>]</span><br></pre></td></tr></table></figure><p>这个例子对我很有思考意义，我的猎奇心理成功被媒体给爆点引导过去，而没有去深究下面很多东西。现在的快餐文化让人们的兴趣停留时间急剧缩短，只有引爆眼球的才能出位，然而对于观众来讲是汲取不到什么营养的，同样猛灌鸡汤的一些大V/公众号的运营也大多参考了这种消费心理，可以迅速获粉。</p><p>那么我们可以做些什么？</p><ul><li>增长见识<ul><li>读书</li><li>和更多类型/身份/处境的人交流</li><li>挖掘一些肉眼看得见或者看不见的东西</li></ul></li><li>主动尝试走出舒适区，给自己一试的勇气<ul><li>舒适区这个东西，跟海绵是一个道理，你不突破它，它就不断吸水巩固自己，最终重到把人死死包围，再也推不开，那个时候再想走出去的话已经难上加难了，每一拳挥上去都被惰性扯掉50%的力道，再被海绵卸去30%的锋利，余力被完整地反弹回来。</li></ul></li><li>坚持用自己的知识去做判断，全面考虑后做出决定，相信自己的判断</li><li>尝试从多个角度看问题</li><li>写博客把自己的思路记下来，或许对别人有益呢</li></ul><p>我在学校里就很喜欢记一些想法，和顾灵通、赵潇潇、周小迪他们相互交换周记来看，想想觉得十分有趣，偶尔翻翻彼时的心思，虽然幼稚，但还是很喜欢那样的自己和大家的。有时甚至入了迷，仿佛在看另外一个人的笔记一样。建这个博客的初衷也是为了让自己养成记录的习惯，不让自己受困温水之中，去认识一些喜欢记录想法的朋友，去更多地认识自己，过好生活。</p><p>写了这么多，不知不觉已经很晚了，外面是三月清冷明亮的夜，都说上海没有春秋，只有冬夏。我坐在窗边，在这个不存在的季节，掸掸灰尘上路了。</p></div><div class="readmore"><a href="/2016/03/14/走出倾斜的世界/">阅读更多</a></div></div><div class="post"><h2 class="post-title"><a href="/2013/05/10/就是用来怀念的/">就是用来怀念的</a></h2><div class="post-meta">2013-05-10</div><a data-thread-key="2013/05/10/就是用来怀念的/" href="/2013/05/10/就是用来怀念的/#comments" class="ds-thread-count"></a><div class="post-content"><p>绳命节拍走进伏笔，此处《A.I.N.Y.》。<br>前一阵看了《致青春》，很美好，不完美的青春和各有好坏的结局。<br>网上看到很多人讨论是选林静还是陈孝正，其实最后我觉的她一个都不会选，青春就是用来怀念的，这些往事伤心也好，幸福也好，伴随微微的成熟，也都看的淡了，全部这些她只是默默保存着，重情的本性也是。<br>整个电影讲的无非从嚣张到温和，从张扬到收敛，从理想到现实，人们都这么走过来，一个转身，就只有以前自己的影子在走，夕阳孤独明媚肩膀都叠在一起成了一个重重的重影。<br>希望所有朋友们都安好，很久不见的大家，下次我会带更多好玩的，一定要来啊；）都准备好了吗《FADE TO BLACK》</p><blockquote><p>潇：最新的是2013年的呐，看来你似乎也慢慢不写了</p></blockquote></div><div class="readmore"><a href="/2013/05/10/就是用来怀念的/">阅读更多</a></div></div><div class="post"><h2 class="post-title"><a href="/2012/10/05/假人/">假人</a></h2><div class="post-meta">2012-10-05</div><a data-thread-key="2012/10/05/假人/" href="/2012/10/05/假人/#comments" class="ds-thread-count"></a><div class="post-content"><p>真的我走到哪里了？</p><p>你也来帮我个忙剖开我的心看看，是什么东西在里面，不跑远的话保不齐我还能看一眼这个从来不喜欢发呆的人，不知道什么时候也开始在电脑前发呆了，彩屏也发现吸引不了任何注意力，灰溜溜地暗下去了。</p><p>太阳要下山，我也下山走了一下，风灌满真个身体的感觉真好，轻快地奔着，把假人留给乌鸦，不管了，上头了，上头了，随便什么鸟来好了。</p><p>风起了，假人越吹越猛，BKB分身BKB分身，肩膀上的乌鸦受了惊吓，玩命儿扑腾着他们巨大的翅膀，瞬间漫天红的绿的彩虹的，黑的白的灰筛的鸟毛挡得什么都看不见，一片混乱中只听一声巨吼！哇丫丫丫丫，SVEN这下牛逼了！！！老诸葛你丫丫丫丫丫丫丫快~快拿命来。</p><p>假人的空城里，只有一个月英的身影，你，可懂？</p><blockquote><p>Ally：”当你发觉头脑里有一个声音总是假扮你，而且喋喋不休时，你便从对思考的无意识认同中苏醒了过来。当你注意到那个声音，你会发现所谓的你并不是那个声音，也不是那个思考者，而是意识到它存在的人，这种知晓你就是那隐于声音背后的知觉，便是自由“<br>”当你静静端详着一棵树或一个人时，你知道是谁在端详么？是某个比你这个人更深邃的东西在端详，是你的意识正在凝视着它创造的杰作“<br>”当你拥抱宁静，心无杂念时，你便能看见神所看见的景象“<br>”上善若水，静水流深“<br>“成千上万只海鸥飞来，东躲西闪争抢一点早饭。然而，海鸥乔纳森.利文斯顿却远离群鸥、海岸和渔船，在远方独自练习飞行”</p></blockquote></div><div class="readmore"><a href="/2012/10/05/假人/">阅读更多</a></div></div><div class="post"><h2 class="post-title"><a href="/2012/06/22/舔爷正是真正的恐惧的化身/">舔爷正是真正的恐惧的化身</a></h2><div class="post-meta">2012-06-22</div><a data-thread-key="2012/06/22/舔爷正是真正的恐惧的化身/" href="/2012/06/22/舔爷正是真正的恐惧的化身/#comments" class="ds-thread-count"></a><div class="post-content"><p>舔爷正是真正的恐惧的化身</p><p>舔爷日渐火起来了，其实火的原因很简单：大家曾今绝对被舔爷虐杀过，守尸过，被迫绕路过，甚至重置游戏过。<br>大家对此怪恶毒的攻击方式及其移动速度痛恨欲绝，甚至对此怪一定程度上产生了阴影。<br>由于上述的原因，导致了舔爷一词一出，忽然间就唤起了广大玩家愤怒的共鸣。<br>从而引出了各种调侃，各种埋怨，各种无厘头。<br>其实大家也都知道，舔爷并不是无敌的存在，在暗黑真正的无敌其实是玩家。<br>因为怪的攻击力是不会成长的。<br>而玩家的装备是会成长的。<br>其实慢慢的有很多玩家已经可以和舔爷火拼甚至已经不虚舔爷了，还有些人通过卡位啊什么也能击杀舔爷。<br>但是有些人可能误解了舔爷一词的含义。<br>因为舔爷给玩家带来的不仅仅是生理上的，更是心理上的一种狠狠的冲击。<br>所以舔爷给大家带来的不仅仅是杀掉它就能抹灭的。<br>它并不是无敌的象征。<br>不是说你杀掉了舔爷就能证明自己什么。<br>舔爷已经不是单单的描述一种怪物的词语它其实象征的是一种恐惧，象征着的是广大玩家对于初期碰到它那种无奈那种无助还带些许绝望所产生的恐惧。<br>它是名词是形容词更是象声词。<br>所以杀了舔爷并不代表任何东西。<br>然而舔爷却已经升华到成为了一种精神。<br>一种对于恐惧无厘头的调侃，一种对于恐惧无厘头的反击。<br>其实大家最后都明白，最终大家都能杀掉舔爷，不管是装备提升，不管是卡位，不管是怎么样。<br>但是舔爷在初期给我们带来的阴影真的不是杀掉它就能够抹去的。<br>其实就如同迪亚波罗的存在一样。<br>谁都杀不死它，因为它是恐惧的化身。<br>舔爷一词的出现就已经证明了它的存在。<br>它其实才是真正的大家心灵里的迪亚波罗。<br>因为它是玩家通过玩暗黑破坏神3才诞生出来的。<br>在一定意义上，其实它才是真正的恐惧的化身。</p></div><div class="readmore"><a href="/2012/06/22/舔爷正是真正的恐惧的化身/">阅读更多</a></div></div><nav class="page-navigator"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/2/">下一页</a></nav></div></div><div id="footer"><div id="footer">© <a href="/." rel="nofollow">Loved One</a><span id="busuanzi_container_site_uv"> 🎼  访客数 </span><span id="busuanzi_value_site_uv"></span><span> 🎵 </span><br><spen>在这个奇葩的时代，只愿做一个不奇葩的男人</spen></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'ilovedone'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-75688320-1','auto');ga('send','pageview');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?a3ac28266bf59d2c9c476373df7553f8";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script type="text/javascript" src="/js/toc.js?v=0.0.0" async></script><script type="text/javascript" src="/js/scroll_to_animation.js?v=0.0.0" async></script></body></html>